<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Truco</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.1.0/socket.io.js" integrity="sha512-+l9L4lMTFNy3dEglQpprf7jQBhQsQ3/WvOnjaN/+/L4i0jOstgScV0q2TjfvRF4V+ZePMDuZYIQtg5T4MKr+MQ==" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <section id = "log" style="display: flex; margin-top: 100px;">
        <form id="login">
            <input type="text" name="nick" placeholder="Digite seu nickname" required>
            
            <button type="submit">JOGAR</button>
        </form>
    </section>
    
    <section id = "game" style="display: none;">
        <div id="mesa">
            <div id="rival"></div>
            <div id="pontos" style="float: right;">
                <div id="ptRiv">Rival: <a>0</a> PTS</div>
                <div id="ptMeu">Eu: <a>0</a> PTS</div>
            </div>
            <div id="minha"></div>
        </div>

        <div id="mao">
            <ul>
                <li></li>
                <li></li>
                <li></li>
            </ul>
        </div>
    </section>
    
    <script>
        const socket = io('http://localhost:3000'); // io vem da CDN

        // LOGIN
        $("#login").submit(function(e){
            e.preventDefault();
            let usu = $("input[name=nick]").val();
            socket.emit('username', usu);
        });
        socket.on("userOk", usu =>{             
            $("section:eq(0)").replaceWith($("section:eq(1)").fadeIn());
            socket.emit('newGame', usu);
        });
        socket.on("userNok", ()=>{
            alert("Nome de usuário indisponivel no momento.");
        });

        // Imprimir mão
        socket.on("cards", J =>{
            for(let x = 0; x<3; x++){
                let nipe = viraNipe(J.mao[x].nipe);
                $(`li:eq(${x})`).html(`<a onclick="atk(${x})">${J.mao[x].num} ${nipe}</a>`);

            }
        });
        
        // Jogar carta
        function atk(x) { socket.emit("cardAtk", x);}
        
        socket.on("AtkAtiv", c =>{
            if(c == null) return;
            else{
                if(($(`#minha`)).text() != ''){
                    $(`#rival`).html('');
                }
                $(`li:eq(${c[0]})`).html('');
                let nipe = viraNipe(c[1].nipe);
                $(`#minha`).html(`${c[1].num} ${nipe}`);
            }
        });
        socket.on("AtkPasv", c =>{
            if(($(`#rival`)).text() != ''){
                $(`#minha`).html('');
            }
            let nipe = viraNipe(c.nipe);
            $(`#rival`).html(`${c.num} ${nipe}`);
        }); 
        // Calcular vitória 
        socket.on("win", ()=>{
            $(`#ptMeu a`).html(Number($(`#ptMeu a`).text())+1);
        });
        socket.on("los", ()=>{
            $(`#ptRiv a`).html(Number($(`#ptRiv a`).text())+1);
        });
    
        function viraNipe(n) {
            let nipe;
            switch (n) {
                case 1:
                    nipe = '♠';
                    break;
                case 2:
                    nipe = '❤';
                    break;
                case 3:
                    nipe = '♣';
                    break;
                case 4:
                    nipe = '♦';
                    break;
            }
            return nipe;
        }
    </script>
</body>
</html>